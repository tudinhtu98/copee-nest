// Prisma schema for Copee

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum UserRole {
  USER
  MOD
  ADMIN
}

enum ProductStatus {
  DRAFT
  READY
  UPLOADED
  FAILED
}

// Models
model User {
  id           String        @id @default(cuid())
  email        String        @unique
  username     String        @unique
  passwordHash String
  role         UserRole      @default(USER)
  balance      Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  products     Product[]
  sites        Site[]
  transactions Transaction[]
}

model Site {
  id               String   @id @default(cuid())
  user             User     @relation(fields: [userId], references: [id])
  userId           String
  name             String
  baseUrl          String
  wooConsumerKey   String
  wooConsumerSecret String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  uploads          UploadJob[]
}

model Product {
  id           String         @id @default(cuid())
  user         User           @relation(fields: [userId], references: [id])
  userId       String
  sourceShop   String
  sourceUrl    String
  title        String
  description  String?
  images       Json?
  price        Int?
  currency     String?
  category     String?
  status       ProductStatus  @default(DRAFT)
  errorMessage String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  uploads      UploadJob[]
}

model UploadJob {
  id             String   @id @default(cuid())
  product        Product  @relation(fields: [productId], references: [id])
  productId      String
  site           Site     @relation(fields: [siteId], references: [id])
  siteId         String
  targetCategory String?
  payload        Json?
  result         Json?
  status         String   @default("PENDING")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Transaction {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  amount      Int
  type        String   // CREDIT/DEBIT
  description String?
  reference   String?
  createdAt   DateTime @default(now())
}
